<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:AssistanceApp.ViewModels"
             x:Class="AssistanceApp.Views.AttendancePage"
             xmlns:Toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="vm:AttendanceViewModel"
             Title="Take Attendance">

    <ContentPage.Behaviors>
        <Toolkit:EventToCommandBehavior EventName="Appearing" Command="{Binding LoadListCommand}" />
    </ContentPage.Behaviors>

    <Grid RowDefinitions="Auto, *, Auto" Padding="10">

        <HorizontalStackLayout Grid.Row="0" Spacing="10" HorizontalOptions="Center" Margin="0,0,0,10">
            <Label Text="Date:" VerticalOptions="Center" FontAttributes="Bold"/>
            <DatePicker Date="{Binding SelectedDate}" Format="d"/>
        </HorizontalStackLayout>

        <CollectionView Grid.Row="1" ItemsSource="{Binding StudentsList}">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="vm:AttendanceItem">
                    <Border Padding="10" Margin="0,5" StrokeShape="RoundRectangle 10">
                        <Grid ColumnDefinitions="*, Auto">

                            <VerticalStackLayout Grid.Column="0" VerticalOptions="Center">
                                <Label Text="{Binding StudentName}" 
                                       FontSize="18" 
                                       FontAttributes="Bold"/>
                                <Label Text="{Binding IsPresent, StringFormat='Status: {0}'}" 
                                       FontSize="12" 
                                       TextColor="Gray"/>
                            </VerticalStackLayout>

                            <Switch Grid.Column="1" 
                                    IsToggled="{Binding IsPresent}" 
                                    OnColor="Green" 
                                    ThumbColor="White"/>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button Grid.Row="2" 
                Text="SAVE ATTENDANCE" 
                Command="{Binding SaveAttendanceCommand}"
                Margin="0,10,0,0"
                HeightRequest="50"
                BackgroundColor="{StaticResource Primary}"/>
    </Grid>
</ContentPage>